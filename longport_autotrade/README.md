# 🚀 LongPort AutoTrader

`LongPort AutoTrader` 是一个基于 Python 开发的轻量级自动化交易脚本。它结合了 `yfinance` 的历史指标分析与 `Finnhub` 的实时价格推送，旨在为长桥证券（LongPort）用户提供一个稳定、具备“记忆力”且自带利润保护的量化交易方案。

---

## ✨ 核心功能

* **双重数据源引擎**：利用 `yfinance` 获取 5 分钟线计算 MA、RSI 等技术指标，同时通过 `Finnhub` 获取秒级实时现价，弥补指标延迟。
* **智能状态持久化**：脚本会自动创建 `trade_state.json`。**即使程序崩溃或电脑重启，重启后也会自动读取历史持仓和买入成本线，继续监控。**
* **利润保护机制**：除了硬性的 5% 止损线外，脚本在执行“死叉卖出信号”时会强制校验：**当前价格必须高于买入价格才卖出**，有效防止在震荡行情中被反复“割肉”。
* **标准化量化策略**：内置经典的“均线金叉/死叉 + RSI 过滤”策略。

---

## 🔄 最近更新计划
### V0.1.0
1.  **初始版本**
### V1.1 优化版
1.  **新增：断电恢复功能**。引入本地 JSON 数据库，启动时自动判断是“继续监控”还是“重新开始”。
2.  **优化：卖出逻辑策略**。增加了 `current_price > buy_price` 的判定，确保非止损情况下不亏损平仓。
3.  **修复：浮点数精度问题**。全面引入 `Decimal` 类型处理所有金额和单价，规避金融计算中的精度陷阱。

---

## 🛠️ 环境准备

在运行脚本前，请确保你的环境中已安装必要的 Python 库：

```bash
pip install pandas numpy yfinance finnhub-python longport
```

---

## ⚙️ 配置指南

在脚本的 `1. 配置区` 中填入你的 API 信息：

| 变量名 | 说明 | 获取途径 |
| :--- | :--- | :--- |
| `APP_KEY` | 长桥 App Key | [长桥开发者中心](https://open.longportapp.com/) |
| `APP_SECRET` | 长桥 App Secret | 长桥开发者中心 |
| `ACCESS_TOKEN` | 长桥 Access Token | 长桥开发者中心 (有效期通常为 90 天) |
| `FINNHUB_API_KEY` | Finnhub 实时数据 Key | [Finnhub.io](https://finnhub.io/) (免费注册) |

---

## 🚦 运行逻辑说明

1.  **策略启动**：脚本检查本地是否存在 `trade_state.json`。
2.  **买入逻辑**：
    * MA5 上穿 MA20（金叉）。
    * 且 RSI < 70（防止超买）。
    * 买入后，记录价格到 `trade_state.json`。
3.  **卖出逻辑**：
    * **硬止损**：现价 < 买入价 * 0.95。直接卖出，保住本金。
    * **策略平仓**：MA5 下穿 MA20（死叉）**且** 现价 > 买入价。
4.  **轮询频率**：默认每 30 秒进行一次全量扫描。

---

## ⚠️ 免责声明

本脚本仅供量化交易学习和参考使用。**金融市场有风险，入市需谨慎**。
* 作者不保证脚本的绝对稳定性，亦不对因脚本运行（如网络延迟、服务器断电、逻辑错误等）导致的任何资金亏损负责。
* 建议在正式投入资金前，先使用长桥证券的 **模拟盘 (Paper Trading)** 环境进行充分测试。
